<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>CineVibe - Movie Mood Curator</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------- Reset / Base ---------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: 'Inter', sans-serif; color: var(--text-primary); background: var(--gradient-bg); background-attachment: fixed; overflow-x: hidden; }

    :root{
      --bg-primary: hsl(240, 15%, 6%);
      --bg-secondary: hsl(240, 12%, 9%);
      --bg-card: hsl(240, 10%, 12%);
      --bg-glass: rgba(20, 20, 30, 0.8);

      --text-primary: hsl(0, 0%, 95%);
      --text-secondary: hsl(240, 5%, 70%);
      --text-muted: hsl(240, 5%, 50%);

      --primary-start: hsl(280, 100%, 60%);
      --primary-end: hsl(320, 100%, 70%);
      --primary-glow: hsl(300, 100%, 80%);

      --accent-cyan: hsl(180, 100%, 60%);
      --accent-blue: hsl(220, 100%, 65%);
      --accent-green: hsl(120, 100%, 60%);

      --border-color: hsl(240, 10%, 20%);
      --border-glow: hsl(240, 10%, 30%);

      --gradient-primary: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      --gradient-glow: linear-gradient(135deg, var(--primary-start), var(--primary-end), var(--accent-cyan));
      --gradient-bg: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-card) 100%);

      --shadow-neon: 0 0 30px rgba(200, 50, 255, 0.3);
      --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.4);
      --shadow-intense: 0 0 50px rgba(200, 50, 255, 0.5);

      --space-1: clamp(0.25rem, 1vw, 0.5rem);
      --space-2: clamp(0.5rem, 1.2vw, 0.75rem);
      --space-3: clamp(0.75rem, 1.6vw, 1rem);
      --space-4: clamp(1rem, 2vw, 1.25rem);
      --space-5: clamp(1.25rem, 3vw, 2rem);
      --radius: 0.75rem;
      --radius-lg: 1rem;
    }

    body::before {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(circle at 20% 80%, rgba(200, 50, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(50, 200, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 50, 150, 0.05) 0%, transparent 50%);
      pointer-events: none; z-index: -1;
      animation: backgroundFloat 20s ease-in-out infinite;
    }
    @keyframes backgroundFloat { 0%,100%{ transform: translateY(0) } 33%{ transform: translateY(-12px) } 66%{ transform: translateY(8px) } }

    /* ---------- Navbar ---------- */
    .navbar{
      position: sticky; top: 0; z-index: 50;
      background: var(--bg-glass); backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      padding: var(--space-2) var(--space-4);
      display: flex; align-items: center; justify-content: space-between;
      gap: var(--space-2);
    }
    .logo{ display:flex; align-items:center; gap: .75rem; cursor:pointer; user-select:none; }
    .logo-icon{
      width: 2.25rem; height: 2.25rem; border-radius: .7rem;
      background: var(--gradient-primary); color:#fff; font-weight:800;
      display:flex; align-items:center; justify-content:center;
      box-shadow: var(--shadow-neon); animation: logoPulse 3s ease-in-out infinite;
    }
    @keyframes logoPulse { 0%,100%{ box-shadow: var(--shadow-neon)} 50%{ box-shadow: var(--shadow-intense)} }
    .logo-text{
      font-family: 'Space Grotesk', sans-serif;
      font-size: clamp(1.1rem, 2.8vw, 1.5rem);
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip:text;
      transition: transform .2s ease, opacity .2s ease;
    }
    .logo:hover .logo-text{ opacity:.9; transform: scale(1.02); }

    .nav-actions{
      display:flex; align-items:center; gap: .5rem; flex-wrap: wrap;
      justify-content: flex-end; max-width: 100%;
    }
    .history-button{
      padding: .55rem .8rem; font-size: .9rem;
      background: transparent; border: 1px solid var(--border-color);
      border-radius: .6rem; color: var(--text-secondary);
      cursor: pointer; transition: all .25s ease; white-space: nowrap;
    }
    .history-button:hover{ border-color: var(--accent-cyan); color: var(--accent-cyan); box-shadow: 0 0 18px rgba(50,200,255,.25); }
    #musicVolume{
      width: clamp(90px, 22vw, 140px); accent-color: hsl(280 100% 65%);
    }

    @media (max-width: 480px){
      .nav-actions{ gap: .4rem; }
      .history-button{ padding: .5rem .65rem; font-size: .85rem; }
    }

    /* ---------- Layout ---------- */
    .container{ max-width: 1200px; margin-inline:auto; padding: var(--space-4); }
    @media (max-width: 768px){ .container{ padding: var(--space-3); } }

    .hero-section{ text-align:center; margin-bottom: var(--space-5); }
    .hero-title{
      font-family:'Space Grotesk',sans-serif;
      font-size: clamp(2rem, 6.5vw, 4.5rem);
      font-weight: 800; margin-bottom: .6rem;
      background: var(--gradient-glow);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      animation: fadeInUp .8s ease-out both;
      position: relative;
    }
    .hero-title::after{
      content:''; position:absolute; bottom:-10px; left:50%; transform:translateX(-50%);
      width: clamp(70px, 14vw, 120px); height: 3px; border-radius:2px;
      background: var(--gradient-primary); opacity: .7;
    }
    .hero-subtitle{
      font-size: clamp(.95rem, 2.7vw, 1.15rem);
      color: var(--text-secondary);
      max-width: min(680px, 92vw);
      margin: 0 auto var(--space-4);
      line-height: 1.6;
      animation: fadeInUp .8s ease-out .15s both;
    }

    .search-form{ max-width: min(760px, 95vw); margin: 0 auto var(--space-5); position: relative; animation: fadeInUp .8s ease-out .3s both; }
    .search-input{
      width: 100%; background: var(--bg-card); color: var(--text-primary);
      border: 2px solid var(--border-color); border-radius: 1rem;
      padding: 1rem 1.1rem; padding-right: clamp(7.2rem, 26vw, 10.5rem);
      font-size: clamp(.95rem, 2.8vw, 1.05rem);
      transition: all .25s ease;
    }
    .search-input:focus{ outline:none; border-color: var(--primary-start); box-shadow: var(--shadow-neon); background: var(--bg-secondary); }
    .search-input::placeholder{ color: var(--text-muted); }
    .search-button{
      position: absolute; right: .4rem; top: 50%; transform: translateY(-50%);
      background: var(--gradient-primary); color:#fff; border:none;
      padding: .7rem 1.1rem; border-radius: .75rem; font-weight: 700; cursor: pointer;
      transition: all .25s ease; font-size: clamp(.9rem, 2.5vw, 1rem);
    }
    .search-button:hover{ box-shadow: var(--shadow-intense); transform: translateY(-50%) scale(1.04); }
    .search-button:disabled{ opacity:.6; cursor:not-allowed; transform: translateY(-50%); }

    /* ---------- Sections ---------- */
    .section-title{
      font-family:'Space Grotesk',sans-serif;
      font-size: clamp(1.25rem, 4.5vw, 2rem);
      font-weight: 800; margin-bottom: .8rem; text-align:center;
      background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }

    .trending-section{ margin-bottom: var(--space-5); animation: fadeInUp .8s ease-out .4s both; }

    .trending-grid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(clamp(120px, 32vw, 170px), 1fr));
      gap: clamp(.6rem, 2vw, 1rem);
    }
    .trending-card{
      background: var(--bg-card); border-radius: .8rem; overflow:hidden; border: 1px solid var(--border-color);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      cursor: pointer; position: relative; isolation: isolate;
    }
    .trending-card::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; z-index:1; pointer-events:none; }
    .trending-card:hover{ transform: translateY(-4px) scale(1.015); box-shadow: var(--shadow-card); border-color: var(--primary-start); }
    .trending-card:hover::before{ opacity: .08; }
    .trending-poster{ width:100%; aspect-ratio: 2/3; object-fit: cover; display:block; }
    .trending-info{ padding: .6rem .7rem; }
    .trending-title{ font-weight: 600; font-size: .95rem; line-height: 1.3; display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical; overflow:hidden; margin:0 0 .25rem; }
    .trending-rating{ color: var(--accent-green); font-size: .85rem; font-weight: 600; }

    /* Mood suggestions */
    .mood-suggestions{ margin-bottom: var(--space-5); animation: fadeInUp .8s ease-out .5s both; }
    .suggestions-title{ display:flex; align-items:center; justify-content:center; gap:.6rem; color: var(--text-secondary); margin-bottom: 1rem; font-weight:600; font-size: clamp(.9rem, 2.8vw, 1rem); }
    .suggestions-grid{ display:flex; flex-wrap:wrap; gap: .6rem .6rem; justify-content:center; max-width: 980px; margin: 0 auto; padding-inline: .2rem; }
    .suggestion-button{
      position: relative; overflow:hidden; cursor:pointer;
      padding: .65rem .95rem; border-radius: 2rem; font-size: clamp(.85rem, 2.7vw, .95rem);
      background: var(--bg-card); color: var(--text-secondary);
      border: 1px solid var(--border-color); transition: all .25s ease;
      touch-action: manipulation;
    }
    .suggestion-button:hover{ color:#fff; border-color: var(--primary-start); transform: translateY(-2px); }
    .suggestion-button::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; border-radius: inherit; }
    .suggestion-button:hover::before{ opacity: 1; }
    .suggestion-button span{ position: relative; z-index: 1; }

    /* History */
    .history-section{ margin-bottom: var(--space-5); display:none; }
    .history-section.show{ display:block; animation: fadeInUp .6s ease-out both; }
    .history-grid{ display:grid; gap: .6rem; max-width: min(820px, 95vw); margin: 0 auto; }
    .history-item{
      display:flex; align-items:center; justify-content:space-between; gap: .8rem;
      padding: .8rem .9rem; border:1px solid var(--border-color); border-radius: .75rem; background: var(--bg-card);
      cursor:pointer; transition: all .25s ease;
    }
    .history-item:hover{ border-color: var(--accent-cyan); background: var(--bg-secondary); }
    .history-mood{ font-weight: 600; color: var(--text-primary); font-size: clamp(.95rem, 2.8vw, 1rem); }
    .history-date{ color: var(--text-muted); font-size: .85rem; }

    /* Movies grid */
    .movies-section{ display:none; }
    .movies-section.show{ display:block; }
    .movies-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(clamp(150px, 42vw, 220px), 1fr));
      gap: clamp(.8rem, 2.5vw, 1.5rem);
      padding: var(--space-4) 0;
    }
    .movie-card{
      background: var(--bg-card); border:1px solid var(--border-color); border-radius: 1rem;
      overflow:hidden; cursor: pointer; position: relative; transition: transform .25s ease, border-color .25s ease, box-shadow .25s ease;
      animation: fadeInUp .6s ease-out both;
    }
    .movie-card:hover{ transform: translateY(-6px) scale(1.02); border-color: var(--primary-start); box-shadow: var(--shadow-card); }
    .movie-card::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; z-index:1; pointer-events:none; }
    .movie-card:hover::before{ opacity: .08; }
    .movie-poster{ width:100%; aspect-ratio: 2/3; object-fit: cover; display:block; position: relative; z-index:2; }
    .movie-info{ padding: .85rem .9rem; position: relative; z-index: 2; }
    .movie-title{ font-weight: 700; margin: 0 0 .35rem; line-height: 1.35; font-size: clamp(.95rem, 2.8vw, 1.05rem); }
    .movie-year{ color: var(--text-secondary); font-size: .9rem; margin: 0 0 .6rem; }
    .movie-platforms{ display:flex; gap:.4rem; flex-wrap:wrap; }
    .platform-badge{ padding: .25rem .5rem; background: var(--gradient-primary); color:#fff; font-size: .7rem; border-radius:.5rem; font-weight:700; }

    /* Loading screen */
    .loading-screen{
      position: fixed; inset: 0; display:none; align-items:center; justify-content:center;
      background: color-mix(in oklab, black 70%, transparent);
      backdrop-filter: blur(20px); z-index: 100;
      padding: var(--space-4);
    }
    .loading-content{ text-align:center; animation: fadeInScale .4s ease-out both; max-width: 90vw; }
    .loading-spinner{
      width: clamp(64px, 20vw, 88px); height: clamp(64px, 20vw, 88px);
      margin: 0 auto 1rem; border: 4px solid var(--border-color); border-top: 4px solid var(--primary-start);
      border-radius: 50%; animation: spin 1s linear infinite; position: relative;
    }
    .loading-spinner::after{
      content:''; position:absolute; inset: .5rem; border: 2px solid transparent; border-top: 2px solid var(--accent-cyan); border-radius:50%;
      animation: spin .8s linear infinite reverse;
    }
    .loading-text{ font-size: clamp(1.1rem, 3.8vw, 1.5rem); font-weight:800; margin: .25rem 0 .4rem;
      background: var(--gradient-primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .loading-subtitle{ color: var(--text-secondary); max-width: 520px; margin: 0 auto; font-size: clamp(.9rem, 2.7vw, 1rem); }
    .loading-dots{ display:flex; gap:.5rem; justify-content:center; margin-top: 1.2rem; }
    .loading-dot{ width:.75rem; height:.75rem; border-radius:50%; background: var(--primary-start); animation: loadingDots 1.4s ease-in-out infinite; }
    .loading-dot:nth-child(2){ animation-delay:.2s; background: var(--primary-end); }
    .loading-dot:nth-child(3){ animation-delay:.4s; background: var(--accent-cyan); }

    /* Modal */
    .modal{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index: 200; padding: var(--space-4); background: rgba(0,0,0,.88); }
    .modal-content{
      background: var(--bg-card); border:1px solid var(--border-glow);
      border-radius: 1rem; width: min(900px, 96vw); max-height: min(90vh, 100svh - 2rem);
      overflow: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none;
      animation: fadeInScale .28s ease-out both; position: relative;
    }
    .modal-content::-webkit-scrollbar{ display:none; }
    .modal-close{
      position: sticky; top: .75rem; float: right; margin: .75rem;
      width: 2.5rem; height: 2.5rem; border-radius: 50%;
      border: none; background: var(--bg-glass); color: var(--text-primary);
      font-size: 1.2rem; cursor: pointer; z-index: 10; transition: background .2s ease, color .2s ease;
    }
    .modal-close:hover{ background: var(--primary-start); color: #fff; }

    /* Auth Modal */
    .auth-modal-content{
      background: var(--bg-card); border: 1px solid var(--border-glow);
      border-radius: 1rem; width: min(480px, 94vw); max-height: min(92vh, 100svh - 2rem);
      overflow:auto; padding: 2rem 1.5rem;
      animation: fadeInScale .25s ease-out both; position: relative;
    }
    .auth-title{ 
      margin: 1rem 0 .5rem; 
      font-family:'Space Grotesk',sans-serif; 
      font-size: clamp(1.5rem, 4.5vw, 2rem); 
      text-align: center;
      background: var(--gradient-primary); 
      -webkit-background-clip:text; 
      -webkit-text-fill-color:transparent; 
      background-clip:text; 
    }
    .auth-subtitle{ 
      color: var(--text-secondary); 
      margin-bottom: 1.5rem; 
      font-size: .95rem; 
      text-align: center;
    }
    .auth-form{ display:flex; flex-direction:column; gap: 1rem; }
    .auth-field{ display:flex; flex-direction:column; gap: .45rem; }
    .auth-label{ color: var(--text-secondary); font-weight:600; font-size:.9rem; }
    .auth-input{
      background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: .65rem;
      color: var(--text-primary); padding: .85rem .9rem; font-size: 1rem; width: 100%;
      transition: all .25s ease;
    }
    .auth-input:focus{ outline:none; border-color: var(--primary-start); box-shadow: var(--shadow-neon); }
    .auth-button{
      padding: .85rem 1.1rem; border-radius: .75rem; font-weight: 800; cursor:pointer; 
      transition: all .25s ease; border: none;
      background: var(--gradient-primary); color: #fff;
    }
    .auth-button:hover{ transform: scale(1.03); box-shadow: var(--shadow-intense); }
    .auth-button:disabled{ opacity:.6; cursor:not-allowed; transform: scale(1); }
    .auth-toggle{
      text-align: center; margin-top: 1rem; color: var(--text-secondary); font-size: .9rem;
    }
    .auth-toggle button{
      background: none; border: none; color: var(--accent-cyan); cursor: pointer;
      text-decoration: underline; font-weight: 600;
    }

    /* Footer */
    .site-footer{ width:100%; background: linear-gradient(180deg, rgba(20,20,30,0) 0%, rgba(12,12,18,1) 30%); border-top: 1px solid var(--border-color); margin-top: var(--space-5); }
    .site-footer__inner{ max-width: 1200px; margin: 0 auto; padding: 1rem var(--space-4); display:flex; align-items:center; justify-content:space-between; gap: .75rem; }
    .site-footer__brand{ color: var(--text-primary); font-weight: 800; letter-spacing: .3px; font-size: clamp(.95rem, 3vw, 1rem); }
    .site-footer__links{ display:flex; align-items:center; gap: .9rem; color: var(--text-secondary); font-weight:700; flex-wrap:wrap; }
    .site-footer__links a{ color: var(--text-secondary); text-decoration:none; border-bottom:1px solid transparent; transition: color .2s ease, border-color .2s ease, transform .2s ease; }
    .site-footer__links a:hover{ color: var(--accent-cyan); border-color: var(--accent-cyan); transform: translateY(-1px); }
    .site-footer__links .dot{ opacity:.35; }
    @media (max-width: 768px){
      .site-footer__inner{ padding: .9rem var(--space-3); flex-direction: column; gap: .4rem; align-items:flex-start; }
    }

    /* Animations */
    @keyframes fadeInUp{ from{ opacity:0; transform: translateY(24px) } to{ opacity:1; transform: translateY(0)} }
    @keyframes fadeInScale{ from{ opacity:0; transform: scale(.94)} to{ opacity:1; transform: scale(1)} }
    @keyframes spin{ to{ transform: rotate(360deg) } }
    @keyframes loadingDots{ 0%,20%{ transform: scale(1) } 50%{ transform: scale(1.5) } 80%,100%{ transform: scale(1) } }

    @media (max-width: 400px){
      .suggestions-grid{ gap: .5rem; }
      .suggestion-button{ padding: .55rem .8rem; }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="logo" id="logoHome">
      <div class="logo-icon">C</div>
      <div class="logo-text">CineVibe</div>
    </div>
    <div class="nav-actions">
      <button class="history-button" id="historyToggle" style="display:none;">üìö History</button>
      <button class="history-button" id="shuffleBtn">üîÄ Shuffle 50</button>
      <button class="history-button" id="musicToggle">üîá Music: Off</button>
      <input id="musicVolume" type="range" min="0" max="1" step="0.01" value="0.25" />
      <button class="history-button" id="authButton">Sign In</button>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container">
    <div class="hero-section" id="heroSection">
      <h1 class="hero-title">What's your vibe today?</h1>
      <p class="hero-subtitle">Drop your mood and let our AI curate the perfect cinematic experience that matches your energy ‚ú®</p>

      <form class="search-form" id="searchForm">
        <input type="text" class="search-input" id="moodInput" placeholder="e.g., something dark and twisted that messes with my mind..." required />
        <button type="submit" class="search-button" id="searchButton">Find Movies</button>
      </form>
    </div>

    <div class="trending-section" id="trendingSection">
      <!-- Your trending content here -->
    </div>

    <div class="history-section" id="historySection">
      <h2 class="section-title">üìö Your Search History</h2>
      <div class="history-grid" id="historyGrid"></div>
    </div>

    <div class="mood-suggestions" id="moodSuggestions">
      <div class="suggestions-title"><span>üí´</span><span>Popular vibes to explore:</span></div>
      <div class="suggestions-grid">
        <button class="suggestion-button" data-mood="something that'll mess with my head and leave me questioning reality"><span>Mind-bending psychological thriller</span></button>
        <button class="suggestion-button" data-mood="aesthetic dark academia vibes with mystery"><span>Dark academia mystery</span></button>
        <button class="suggestion-button" data-mood="chaotic energy with unhinged characters"><span>Chaotic energy films</span></button>
        <button class="suggestion-button" data-mood="nostalgic 90s/2000s comfort movies"><span>Y2K nostalgia comfort</span></button>
        <button class="suggestion-button" data-mood="visually stunning sci-fi that blows my mind"><span>Visually stunning sci-fi</span></button>
        <button class="suggestion-button" data-mood="lesbian/sapphic romance that makes me cry happy tears"><span>Sapphic romance tearjerker</span></button>
        <button class="suggestion-button" data-mood="foreign films that are pure cinema"><span>Foreign cinema masterpieces</span></button>
        <button class="suggestion-button" data-mood="underground cult classics nobody talks about"><span>Underground cult classics</span></button>
        <button class="suggestion-button" data-mood="horror that's actually scary not just jumpscares"><span>Actually scary horror</span></button>
        <button class="suggestion-button" data-mood="feel-good movies that restore faith in humanity"><span>Faith in humanity restored</span></button>
      </div>
    </div>

    <div class="movies-section" id="moviesSection">
      <h2 class="section-title" id="moviesTitle">Your Curated Selection</h2>
      <div class="movies-grid" id="moviesGrid"></div>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2 class="loading-text">Curating your perfect vibe<span id="loadingDots">...</span></h2>
      <p class="loading-subtitle">Our AI is analyzing your mood and finding movies that match your exact energy</p>
      <div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
    </div>
  </div>

  <!-- Movie Modal -->
  <div class="modal" id="movieModal">
    <div class="modal-content" id="modalContent">
      <button class="modal-close" id="modalClose" aria-label="Close">&times;</button>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="authModal">
    <div class="auth-modal-content">
      <button class="modal-close" id="authModalClose" aria-label="Close">&times;</button>
      
      <div class="logo" style="justify-content: center; margin-bottom: 1rem;">
        <div class="logo-icon">C</div>
        <div class="logo-text">CineVibe</div>
      </div>

      <h2 class="auth-title" id="authModalTitle">Welcome Back</h2>
      <p class="auth-subtitle" id="authModalSubtitle">Sign in to access your curated movie collection</p>

      <form class="auth-form" id="authForm">
        <div class="auth-field">
          <label class="auth-label">Email</label>
          <input type="email" id="authEmail" class="auth-input" placeholder="you@example.com" required>
        </div>
        <div class="auth-field">
          <label class="auth-label">Password</label>
          <input type="password" id="authPassword" class="auth-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
        </div>
        <button type="submit" class="auth-button" id="authSubmitBtn">Sign In</button>
      </form>

      <div class="auth-toggle">
        <span id="authToggleText">Don't have an account?</span>
        <button type="button" id="authToggleBtn">Sign up</button>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="site-footer__inner">
      <div class="site-footer__brand">¬© 2025 Jayesh_Mal</div>
      <nav class="site-footer__links">
        <a href="https://www.instagram.com/jayesh_cringzz/" target="_blank" rel="noopener">Instagram</a>
        <span class="dot">‚Ä¢</span>
        <a href="https://github.com/jayesh25-trade" target="_blank" rel="noopener">GitHub</a>
      </nav>
    </div>
  </footer>

  <!-- Supabase JS -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <script>
    /************************************************************************
     * CineVibe - Updated front-end (FULL) - requires login before calling
     * /api/recommend. Sends Authorization: Bearer <supabase_access_token>
     ************************************************************************/

    // ---------- Supabase (keep key inline per your request) ----------
    const SUPABASE_URL = 'https://zglrxflhkdlksbkohnry.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpnbHJ4Zmxoa2Rsa3Nia29obnJ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MjE5MDIsImV4cCI6MjA3ODk5NzkwMn0.AewHBx__MlULdhVrvVA7O3rFGtO5smIXX_ljHcvxf00';
    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);

    // ---------- State ----------
    let currentUser = null;      // supabase user object (user info)
    let currentSession = null;   // supabase session (contains access_token)

    // ---------- DOM ----------
    const authButton = document.getElementById('authButton');
    const authModal = document.getElementById('authModal');
    const authModalClose = document.getElementById('authModalClose');
    const authForm = document.getElementById('authForm');
    const authModalTitle = document.getElementById('authModalTitle');
    const authModalSubtitle = document.getElementById('authModalSubtitle');
    const authSubmitBtn = document.getElementById('authSubmitBtn');
    const authToggleBtn = document.getElementById('authToggleBtn');
    const authToggleText = document.getElementById('authToggleText');
    const searchForm = document.getElementById('searchForm');
    const historyToggle = document.getElementById('historyToggle');
    const historySection = document.getElementById('historySection');
    const historyGrid = document.getElementById('historyGrid');
    const loadingScreen = document.getElementById('loadingScreen');
    const moodInput = document.getElementById('moodInput');
    const moviesGrid = document.getElementById('moviesGrid');
    const moviesSection = document.getElementById('moviesSection');
    const moviesTitle = document.getElementById('moviesTitle');
    const logoHome = document.getElementById('logoHome');
    const shuffleBtn = document.getElementById('shuffleBtn');

    // music UI
    const musicToggleBtn = document.getElementById('musicToggle');
    const musicVolume = document.getElementById('musicVolume');

    // suggestion buttons (delegation)
    const suggestionButtons = document.querySelectorAll('.suggestion-button');

    // ---------- Helpers ----------
    function toast(msg, timeout = 1600) {
      const el = document.createElement('div');
      el.style.cssText = 'position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(0,0,0,0.7);color:#fff;padding:10px 14px;border-radius:12px;z-index:99999;font-family:Inter,system-ui;font-size:14px';
      el.textContent = msg;
      document.body.appendChild(el);
      setTimeout(()=>{ el.style.opacity='0'; setTimeout(()=>el.remove(),260); }, timeout);
    }

    function showNotification(message, type='info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 5rem;
        right: 1rem;
        background: var(--bg-card);
        border: 1px solid ${type === 'error' ? 'hsl(0, 84%, 60%)' : 'var(--accent-cyan)'};
        color: var(--text-primary);
        padding: 1rem 1.5rem;
        border-radius: .75rem;
        z-index: 1000;
        animation: slideInRight .3s ease-out;
        box-shadow: var(--shadow-card);
        max-width: 90vw;
      `;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.style.animation = 'slideOutRight .3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }

    // Add slide animations
    (function addSlideStyles(){
      const style = document.createElement('style');
      style.textContent = `
      @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }`;
      document.head.appendChild(style);
    })();

    // ---------- Auth state handling ----------
    supabaseClient.auth.onAuthStateChange((event, session) => {
      currentSession = session ?? null;
      currentUser = session?.user ?? null;
      updateUIForAuth();
      // if user logged in and history is open, load it
      if (currentUser && historySection.classList.contains('show')) loadHistory();
    });

    // initial check
    (async () => {
      const { data } = await supabaseClient.auth.getSession();
      currentSession = data?.session ?? null;
      currentUser = data?.session?.user ?? null;
      updateUIForAuth();
    })();

    function updateUIForAuth(){
      if (currentUser) {
        authButton.textContent = 'Sign Out';
        historyToggle.style.display = 'block';
      } else {
        authButton.textContent = 'Sign In';
        historyToggle.style.display = 'none';
        historySection.classList.remove('show');
      }
    }

    // Auth button click
    authButton.addEventListener('click', () => {
      if (currentUser) {
        // sign out
        supabaseClient.auth.signOut().then(() => {
          currentUser = null; currentSession = null;
          updateUIForAuth();
          showNotification('Signed out', 'info');
        }).catch(err => { showNotification(err.message || 'Sign out failed', 'error'); });
      } else {
        openAuthModal();
      }
    });

    // open/close auth modal
    function openAuthModal() {
      authModal.style.display = 'flex';
      updateAuthModal();
    }
    authModalClose.addEventListener('click', ()=> authModal.style.display='none');
    authModal.addEventListener('click', (e) => { if (e.target === authModal) authModal.style.display='none'; });

    // toggle login/signup
    let isLogin = true;
    authToggleBtn.addEventListener('click', () => { isLogin = !isLogin; updateAuthModal(); });
    function updateAuthModal(){
      if (isLogin) {
        authModalTitle.textContent = 'Welcome Back';
        authModalSubtitle.textContent = 'Sign in to access your curated movie collection';
        authSubmitBtn.textContent = 'Sign In';
        authToggleText.textContent = "Don't have an account?";
        authToggleBtn.textContent = 'Sign up';
      } else {
        authModalTitle.textContent = 'Create Account';
        authModalSubtitle.textContent = 'Join CineVibe to start your cinematic journey';
        authSubmitBtn.textContent = 'Sign Up';
        authToggleText.textContent = 'Already have an account?';
        authToggleBtn.textContent = 'Sign in';
      }
    }

    // handle auth form submit (sign in / sign up)
    authForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('authEmail').value;
      const password = document.getElementById('authPassword').value;
      if (!email || !password) return showNotification('Please provide email & password', 'error');

      authSubmitBtn.disabled = true;
      authSubmitBtn.textContent = 'Processing...';
      try {
        if (isLogin) {
          const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
          if (error) throw error;
          authForm.reset();
          authModal.style.display = 'none';
          showNotification('Signed in ‚Äî enjoy!', 'success');
        } else {
          const { error } = await supabaseClient.auth.signUp({ email, password, options: { emailRedirectTo: window.location.origin } });
          if (error) throw error;
          authForm.reset();
          authModal.style.display = 'none';
          showNotification('Account created ‚Äî check email to confirm', 'success');
        }
      } catch (err) {
        showNotification(err.message || 'Auth error', 'error');
      } finally {
        authSubmitBtn.disabled = false;
        updateAuthModal();
      }
    });

    // ---------- History ----------
    historyToggle.addEventListener('click', () => {
      historySection.classList.toggle('show');
      if (historySection.classList.contains('show')) loadHistory();
    });

    async function loadHistory() {
      if (!currentUser) return;
      try {
        const { data, error } = await supabaseClient
          .from('search_history')
          .select('*')
          .eq('user_id', currentUser.id)
          .order('searched_at', { ascending: false })
          .limit(20);
        if (error) throw error;
        historyGrid.innerHTML = '';
        if (!data || data.length === 0) {
          historyGrid.innerHTML = '<p style="text-align:center; color: var(--text-secondary); padding: 2rem;">No searches yet. Start exploring!</p>';
          return;
        }
        data.forEach(item => {
          const historyItem = document.createElement('div');
          historyItem.className = 'history-item';
          historyItem.innerHTML = `
            <div>
              <div class="history-mood">${escapeHtml(item.mood_query)}</div>
              <div class="history-date">${formatDate(item.searched_at)}</div>
            </div>
            <div style="color: var(--text-muted); font-size: .85rem;">${item.results_count || 0} results</div>
          `;
          historyItem.addEventListener('click', () => {
            moodInput.value = item.mood_query;
            historySection.classList.remove('show');
          });
          historyGrid.appendChild(historyItem);
        });
      } catch (err) {
        console.error('History load error', err);
      }
    }

    // ---------- Search handling (BLOCKED if not logged in) ----------
    // This is the core fix: search will NOT call backend unless currentSession exists.
    searchForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!currentUser || !currentSession) {
        showNotification('Please sign in to search for movies', 'error');
        openAuthModal();
        return;
      }

      const mood = (moodInput.value || '').trim();
      if (!mood) return;

      // show loading
      loadingScreen.style.display = 'flex';

      try {
        // 1) Save to supabase search_history (optional)
        const insertPayload = {
          user_id: currentUser.id,
          mood_query: mood,
          results_count: 0,
          searched_at: new Date().toISOString()
        };
        const { error: insertError } = await supabaseClient.from('search_history').insert(insertPayload);
        if (insertError) console.warn('Could not save history:', insertError.message || insertError);

        // 2) Call backend with Authorization header containing Supabase access token
        const backendUrl = (location.hostname.includes('localhost') ? 'http://localhost:5000' : 'https://cinevibe-movie.onrender.com') + '/api/recommend';

        const res = await fetch(backendUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            // PASS the Supabase access token to backend for validation
            'Authorization': `Bearer ${currentSession.access_token}`
          },
          body: JSON.stringify({ mood })
        });

        const data = await res.json();
        if (!res.ok) {
          const msg = data?.error || `Server error (${res.status})`;
          throw new Error(msg);
        }

        // show movies
        showMovies(data.movies || []);
        moviesTitle.textContent = `Movies for "${mood}"`;
        if (moviesSection) moviesSection.classList.add('show');
        if (historySection && historySection.classList.contains('show')) historySection.classList.remove('show');

        // update results_count in history (best effort)
        try {
          const count = Array.isArray(data.movies) ? data.movies.length : 0;
          await supabaseClient.from('search_history').update({ results_count: count }).eq('user_id', currentUser.id).eq('mood_query', mood);
        } catch (err) {
          // non-blocking
        }

      } catch (err) {
        console.error('Search error', err);
        showNotification(err.message || 'Failed to fetch recommendations', 'error');
      } finally {
        loadingScreen.style.display = 'none';
      }
    });

    // ---------- Movie rendering ----------
    function showMovies(movies) {
      if (!moviesGrid) return;
      moviesGrid.innerHTML = '';
      if (!movies || !movies.length) {
        moviesGrid.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:2rem">No recommendations found.</p>';
        return;
      }

      movies.forEach((m, i) => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.style.animationDelay = `${Math.min(i*0.06,4)}s`;
        card.innerHTML = `
          <img src="${escapeAttr(m.poster || '/placeholder-movie.jpg')}" alt="${escapeAttr(m.title || 'Movie')}" class="movie-poster" loading="lazy">
          <div class="movie-info">
            <h3 class="movie-title">${escapeHtml(m.title || '')}</h3>
            <p class="movie-year">${escapeHtml(toYear(m.releaseDate) || '')}</p>
            <div class="movie-platforms">${(m.ottPlatforms||[]).slice(0,3).map(p=>`<span class="platform-badge">${escapeHtml(p.name)}</span>`).join('')}</div>
          </div>
        `;
        // click opens modal (call details endpoint)
        card.addEventListener('click', () => openMovieModalById(m.id));
        moviesGrid.appendChild(card);
      });
    }

    async function openMovieModalById(id) {
      if (!id) return;
      const modal = document.getElementById('movieModal');
      const modalContent = document.getElementById('modalContent');
      if (!modal || !modalContent) return;
      modalContent.innerHTML = '<button class="modal-close" id="modalClose">&times;</button><div style="padding:2rem;">Loading details‚Ä¶</div>';
      modal.style.display = 'flex';
      // fetch details from backend
      try {
        const backendUrl = (location.hostname.includes('localhost') ? 'http://localhost:5000' : 'https://cinevibe-movie.onrender.com') + `/api/details/${encodeURIComponent(String(id))}`;
        const res = await fetch(backendUrl);
        const json = await res.json();
        if (!res.ok) throw new Error(json?.error || 'Details not found');

        const movie = json.movie;
        renderMovieModalContent(movie);
      } catch (err) {
        modalContent.innerHTML = `<button class="modal-close" id="modalClose">&times;</button><div style="padding:2rem;">Failed to load details: ${escapeHtml(String(err.message || err))}</div>`;
      }

      // close button hookup
      const closeBtn = document.getElementById('modalClose');
      if (closeBtn) closeBtn.addEventListener('click', closeModalOnce);
      modal.addEventListener('click', (e) => { if (e.target === modal) closeModalOnce(); }, { once: true });
    }

    function renderMovieModalContent(movie) {
      const modalContent = document.getElementById('modalContent');
      if (!modalContent) return;
      if (!movie) {
        modalContent.innerHTML = `<button class="modal-close" id="modalClose">&times;</button><div style="padding:2rem;">No details available</div>`;
        return;
      }
      const rating = Number.isFinite(movie.rating) ? Number(movie.rating).toFixed(1) : '‚Äî';
      const genres = (movie.genres||[]).map(g => `<span style="padding:.25rem .5rem;margin-right:.35rem;background:linear-gradient(90deg,var(--primary-start),var(--primary-end));color:#fff;border-radius:.5rem;font-size:.85rem">${escapeHtml(g)}</span>`).join('');
      const platforms = (movie.ottPlatforms||[]).map(p => `<div style="padding:.45rem;border-radius:.5rem;border:1px solid var(--border-color);margin-bottom:.45rem;display:flex;align-items:center;justify-content:space-between;background:${p.available?'rgba(200,50,255,0.06)':'transparent'}"><span>${escapeHtml(p.name)}</span>${p.available && p.url?`<a href="${escapeAttr(p.url)}" target="_blank" rel="noopener" style="color:var(--accent-cyan);font-weight:600;text-decoration:none">Watch</a>`:''}</div>`).join('');

      modalContent.innerHTML = `
        <button class="modal-close" id="modalClose">&times;</button>
        ${movie.backdrop?`<img src="${escapeAttr(movie.backdrop)}" style="width:100%;height:260px;object-fit:cover;border-radius:1rem 1rem 0 0;">`:''}
        <div style="padding:1.25rem;">
          <h2 style="font-family:Space Grotesk, sans-serif;font-size:1.6rem;margin:0 0 .6rem">${escapeHtml(movie.title)}</h2>
          <div style="color:var(--text-secondary);margin-bottom:.8rem">‚≠ê ${rating} ¬∑ ${escapeHtml(toYear(movie.releaseDate) || '')}</div>
          <p style="color:var(--text-secondary);line-height:1.5">${escapeHtml(movie.overview || '')}</p>

          <div style="margin-top:1rem"><h4 style="color:var(--accent-cyan)">Genres</h4><div style="display:flex;flex-wrap:wrap;gap:.35rem">${genres}</div></div>

          <div style="margin-top:1rem"><h4 style="color:var(--accent-cyan)">Available On</h4>${platforms || '<div style="opacity:.7;color:var(--text-secondary)">No platform info</div>'}</div>

          ${movie.trailerUrl ? `<div style="margin-top:1rem"><h4 style="color:var(--accent-cyan)">Trailer</h4><iframe src="${escapeAttr(movie.trailerUrl)}" width="100%" height="300" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen style="border-radius:.5rem;border:1px solid var(--border-color);"></iframe></div>` : ''}
        </div>
      `;
    }

    function closeModalOnce() {
      const modal = document.getElementById('movieModal');
      if (modal) modal.style.display = 'none';
      // stop iframes
      const modalContent = document.getElementById('modalContent');
      if (modalContent) {
        modalContent.querySelectorAll('iframe').forEach(f => f.src = 'about:blank');
      }
    }

    // ---------- Misc UI helpers ----------
    function escapeHtml(str) {
      if (str == null) return '';
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }
    function escapeAttr(s){ return escapeHtml(s).replaceAll('"','&quot;'); }
    function toYear(d) { try { const y=new Date(d).getFullYear(); return Number.isFinite(y) && y>1900?y:''; } catch { return ''; } }

    function formatDate(dateString) {
      if (!dateString) return '';
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);
      const days = Math.floor(diff / 86400000);
      if (minutes < 60) return `${minutes} minute${minutes !== 1 ? 's' : ''} ago`;
      if (hours < 24) return `${hours} hour${hours !== 1 ? 's' : ''} ago`;
      if (days < 7) return `${days} day${days !== 1 ? 's' : ''} ago`;
      return date.toLocaleDateString();
    }

    // Suggestion buttons behavior
    suggestionButtons.forEach(btn => btn.addEventListener('click', () => {
      moodInput.value = btn.dataset.mood || '';
    }));

    // Logo reload
    if (logoHome) logoHome.addEventListener('click', () => location.reload());

    // ---------- Shuffle (calls backend /api/trending/all and then details) ----------
    if (shuffleBtn) {
      shuffleBtn.addEventListener('click', async () => {
        // user must be logged in to see full details as per policy ‚Äî block if not authenticated
        if (!currentUser || !currentSession) {
          showNotification('Please sign in to shuffle and view movies', 'error');
          openAuthModal();
          return;
        }
        loadingScreen.style.display = 'flex';
        try {
          const backendBase = (location.hostname.includes('localhost') ? 'http://localhost:5000' : 'https://cinevibe-movie.onrender.com');
          const res = await fetch(`${backendBase}/api/trending/all`);
          const data = await res.json();
          if (!res.ok) throw new Error(data?.error || 'Failed to fetch trending');
          // collect a pool and call /api/details for each id to get rating etc, but for simplicity, use hollywood + bollywood + anime arrays
          const pool = [...(data.hollywood||[]), ...(data.bollywood||[]), ...(data.anime||[])].slice(0, 60);
          // fetch details for each id (best-effort)
          const detailPromises = pool.map(p => fetch(`${backendBase}/api/details/${encodeURIComponent(String(p.id))}`).then(r=>r.json()).catch(()=>null));
          const detailed = (await Promise.all(detailPromises)).map(x=>x?.movie).filter(Boolean);
          const final = detailed.filter(m => (m.rating||0) > 5.0).slice(0,50);
          showMovies(final);
          moviesTitle.textContent = `üé≤ Shuffle Mix (50) ‚Äî Mixed`;
          if (moviesSection) moviesSection.classList.add('show');
        } catch (err) {
          showNotification(err.message || 'Shuffle failed', 'error');
        } finally {
          loadingScreen.style.display = 'none';
        }
      });
    }

    // ---------- Music (basic) ----------
    let bgAudio = null; let bgMusicEnabled = false; let lastTheme = null;
    const BG_MUSIC = {
      romantic:'/music/Fall-In-Love-chosic.com_.mp3',
      sad:'/music/scott-buckley-moonlight(chosic.com).mp3',
      suspense:'/music/Hidden-Agenda(chosic.com).mp3',
      horror:'/music/Incantation-chosic.com_.mp3',
      comedy:'/music/Monkeys-Spinning-Monkeys(chosic.com).mp3',
      action:'/music/Last-Call-chosic.com_.mp3',
      scifi:'/music/suspense-sci-fi-underscore-music-loop-300215.mp3',
      chill:'/music/Heart-Of-The-Ocean(chosic.com).mp3',
      upbeat:'/music/HEROICCC(chosic.com).mp3',
    };

    function ensureBgAudio() {
      if (!bgAudio) { bgAudio = new Audio(); bgAudio.loop=true; bgAudio.volume = musicVolume ? Number(musicVolume.value) : 0.25; }
      return bgAudio;
    }
    async function enableBgMusic() { bgMusicEnabled = true; ensureBgAudio(); try { await bgAudio.play(); } catch {} }
    function disableBgMusic() { bgMusicEnabled = false; if (bgAudio) try{ bgAudio.pause(); } catch{} }
    function pickThemeFromText(txt) {
      const t = (txt||'').toLowerCase();
      if (/(romance|romantic|love)/.test(t)) return 'romantic';
      if (/(sad|melancholy|tragic|cry)/.test(t)) return 'sad';
      if (/(suspense|thrill|mystery|twist)/.test(t)) return 'suspense';
      if (/(horror|scary|terrifying)/.test(t)) return 'horror';
      if (/(comedy|funny|laugh)/.test(t)) return 'comedy';
      if (/(action|fight|battle|chase)/.test(t)) return 'action';
      if (/(sci[- ]?fi|space|cyberpunk)/.test(t)) return 'scifi';
      if (/(feel[- ]?good|uplifting|happy|party)/.test(t)) return 'upbeat';
      return 'chill';
    }
    async function setMoodMusicFromText(txt) {
      const theme = pickThemeFromText(txt);
      const src = BG_MUSIC[theme];
      if (!src) return;
      ensureBgAudio();
      const abs = new URL(src, location.href).toString();
      if (bgAudio.src !== abs) { bgAudio.src = abs; bgAudio.load(); }
      if (bgMusicEnabled) try { await bgAudio.play(); } catch {}
    }

    if (musicToggleBtn) {
      musicToggleBtn.addEventListener('click', async () => {
        if (!bgMusicEnabled) { await enableBgMusic(); musicToggleBtn.textContent='üîä Music: On'; }
        else { disableBgMusic(); musicToggleBtn.textContent='üîá Music: Off'; }
      });
    }
    if (musicVolume) musicVolume.addEventListener('input', ()=> { ensureBgAudio(); bgAudio.volume = Number(musicVolume.value); });

    // ------ Utility: safe text extraction ------
    function getApiBase() {
      return location.hostname.includes('localhost') ? 'http://localhost:5000' : 'https://cinevibe-movie.onrender.com';
    }

    // ---------- On DOM ready load trending rows (optional) ----------
    document.addEventListener('DOMContentLoaded', () => {
      // attempt to load trending grid (best-effort)
      (async () => {
        try {
          const res = await fetch(getApiBase() + '/api/trending');
          const data = await res.json();
          if (res.ok && Array.isArray(data.movies)) {
            const g = document.createElement('div');
            g.className = 'trending-grid';
            (data.movies||[]).slice(0,8).forEach(m => {
              const card = document.createElement('div');
              card.className = 'trending-card';
              card.innerHTML = `<img src="${escapeAttr(m.poster||'/placeholder-movie.jpg')}" class="trending-poster" loading="lazy">
                <div class="trending-info"><h3 class="trending-title">${escapeHtml(m.title)}</h3><p class="trending-rating">‚≠ê ${Number.isFinite(m.rating)?Number(m.rating).toFixed(1):'‚Äî'}</p></div>`;
              card.addEventListener('click', () => openMovieModalById(m.id));
              g.appendChild(card);
            });
            const sec = document.getElementById('trendingSection');
            if (sec) { sec.innerHTML = '<h2 class="section-title">üî• Trending</h2>'; sec.appendChild(g); }
          }
        } catch (e) { /* ignore */ }
      })();
    });

    // Escape any user input printed into DOM
    // Done above with escapeHtml / escapeAttr

    // END of script
  </script>

  <script src="./prompt.js" defer></script>
</body>
</html>
