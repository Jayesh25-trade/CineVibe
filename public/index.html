<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="icon" type="image/png" href="/favicon.png">
  <title>CineVibe - Movie Mood Curator</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ---------- Reset / Base ---------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: 'Inter', sans-serif; color: var(--text-primary); background: var(--gradient-bg); background-attachment: fixed; overflow-x: hidden; }

    :root{
      --bg-primary: hsl(240, 15%, 6%);
      --bg-secondary: hsl(240, 12%, 9%);
      --bg-card: hsl(240, 10%, 12%);
      --bg-glass: rgba(20, 20, 30, 0.8);

      --text-primary: hsl(0, 0%, 95%);
      --text-secondary: hsl(240, 5%, 70%);
      --text-muted: hsl(240, 5%, 50%);

      --primary-start: hsl(280, 100%, 60%);
      --primary-end: hsl(320, 100%, 70%);
      --primary-glow: hsl(300, 100%, 80%);

      --accent-cyan: hsl(180, 100%, 60%);
      --accent-blue: hsl(220, 100%, 65%);
      --accent-green: hsl(120, 100%, 60%);

      --border-color: hsl(240, 10%, 20%);
      --border-glow: hsl(240, 10%, 30%);

      --gradient-primary: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      --gradient-glow: linear-gradient(135deg, var(--primary-start), var(--primary-end), var(--accent-cyan));
      --gradient-bg: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-card) 100%);

      --shadow-neon: 0 0 30px rgba(200, 50, 255, 0.3);
      --shadow-card: 0 10px 40px rgba(0, 0, 0, 0.4);
      --shadow-intense: 0 0 50px rgba(200, 50, 255, 0.5);

      --space-1: clamp(0.25rem, 1vw, 0.5rem);
      --space-2: clamp(0.5rem, 1.2vw, 0.75rem);
      --space-3: clamp(0.75rem, 1.6vw, 1rem);
      --space-4: clamp(1rem, 2vw, 1.25rem);
      --space-5: clamp(1.25rem, 3vw, 2rem);
      --radius: 0.75rem;
      --radius-lg: 1rem;
    }

    /* animated soft ambient background */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background:
        radial-gradient(circle at 20% 80%, rgba(200, 50, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(50, 200, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 50, 150, 0.05) 0%, transparent 50%);
      pointer-events: none; z-index: -1;
      animation: backgroundFloat 20s ease-in-out infinite;
    }
    @keyframes backgroundFloat { 0%,100%{ transform: translateY(0) } 33%{ transform: translateY(-12px) } 66%{ transform: translateY(8px) } }

    /* ---------- Navbar ---------- */
    .navbar{
      position: sticky; top: 0; z-index: 50;
      background: var(--bg-glass); backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border-color);
      padding: var(--space-2) var(--space-4);
      display: flex; align-items: center; justify-content: space-between;
      gap: var(--space-2);
    }
    .logo{ display:flex; align-items:center; gap: .75rem; cursor:pointer; user-select:none; }
    .logo-icon{
      width: 2.25rem; height: 2.25rem; border-radius: .7rem;
      background: var(--gradient-primary); color:#fff; font-weight:800;
      display:flex; align-items:center; justify-content:center;
      box-shadow: var(--shadow-neon); animation: logoPulse 3s ease-in-out infinite;
    }
    @keyframes logoPulse { 0%,100%{ box-shadow: var(--shadow-neon)} 50%{ box-shadow: var(--shadow-intense)} }
    .logo-text{
      font-family: 'Space Grotesk', sans-serif;
      font-size: clamp(1.1rem, 2.8vw, 1.5rem);
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip:text;
      transition: transform .2s ease, opacity .2s ease;
    }
    .logo:hover .logo-text{ opacity:.9; transform: scale(1.02); }

    .nav-actions{
      display:flex; align-items:center; gap: .5rem; flex-wrap: wrap;
      justify-content: flex-end; max-width: 100%;
    }
    .history-button{
      padding: .55rem .8rem; font-size: .9rem;
      background: transparent; border: 1px solid var(--border-color);
      border-radius: .6rem; color: var(--text-secondary);
      cursor: pointer; transition: all .25s ease; white-space: nowrap;
    }
    .history-button:hover{ border-color: var(--accent-cyan); color: var(--accent-cyan); box-shadow: 0 0 18px rgba(50,200,255,.25); }

    @media (max-width: 480px){
      .nav-actions{ gap: .4rem; }
      .history-button{ padding: .5rem .65rem; font-size: .85rem; }
    }

    /* ---------- Layout ---------- */
    .container{ max-width: 1200px; margin-inline:auto; padding: var(--space-4); }
    @media (max-width: 768px){ .container{ padding: var(--space-3); } }

    .hero-section{ text-align:center; margin-bottom: var(--space-5); }
    .hero-title{
      font-family:'Space Grotesk',sans-serif;
      font-size: clamp(2rem, 6.5vw, 4.5rem);
      font-weight: 800; margin-bottom: .6rem;
      background: var(--gradient-glow);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
      animation: fadeInUp .8s ease-out both;
      position: relative;
    }
    .hero-title::after{
      content:''; position:absolute; bottom:-10px; left:50%; transform:translateX(-50%);
      width: clamp(70px, 14vw, 120px); height: 3px; border-radius:2px;
      background: var(--gradient-primary); opacity: .7;
    }
    .hero-subtitle{
      font-size: clamp(.95rem, 2.7vw, 1.15rem);
      color: var(--text-secondary);
      max-width: min(680px, 92vw);
      margin: 0 auto var(--space-4);
      line-height: 1.6;
      animation: fadeInUp .8s ease-out .15s both;
    }

    .search-form{ max-width: min(760px, 95vw); margin: 0 auto var(--space-5); position: relative; animation: fadeInUp .8s ease-out .3s both; }
    .search-input{
      width: 100%; background: var(--bg-card); color: var(--text-primary);
      border: 2px solid var(--border-color); border-radius: 1rem;
      padding: 1rem 1.1rem; padding-right: clamp(7.2rem, 26vw, 10.5rem);
      font-size: clamp(.95rem, 2.8vw, 1.05rem);
      transition: all .25s ease;
    }
    .search-input:focus{ outline:none; border-color: var(--primary-start); box-shadow: var(--shadow-neon); background: var(--bg-secondary); }
    .search-input::placeholder{ color: var(--text-muted); }
    .search-button{
      position: absolute; right: .4rem; top: 50%; transform: translateY(-50%);
      background: var(--gradient-primary); color:#fff; border:none;
      padding: .7rem 1.1rem; border-radius: .75rem; font-weight: 700; cursor: pointer;
      transition: all .25s ease; font-size: clamp(.9rem, 2.5vw, 1rem);
    }
    .search-button:hover{ box-shadow: var(--shadow-intense); transform: translateY(-50%) scale(1.04); }
    .search-button:disabled{ opacity:.6; cursor:not-allowed; transform: translateY(-50%); }

    /* ---------- Sections ---------- */
    .section-title{
      font-family:'Space Grotesk',sans-serif;
      font-size: clamp(1.25rem, 4.5vw, 2rem);
      font-weight: 800; margin-bottom: .8rem; text-align:center;
      background: linear-gradient(45deg, var(--accent-cyan), var(--accent-blue));
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }

    .trending-section{ margin-bottom: var(--space-5); animation: fadeInUp .8s ease-out .4s both; }

    .trending-grid{
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(clamp(120px, 32vw, 170px), 1fr));
      gap: clamp(.6rem, 2vw, 1rem);
    }
    .trending-card{
      background: var(--bg-card); border-radius: .8rem; overflow:hidden; border: 1px solid var(--border-color);
      transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
      cursor: pointer; position: relative; isolation: isolate;
    }
    .trending-card::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; z-index:1; pointer-events:none; }
    .trending-card:hover{ transform: translateY(-4px) scale(1.015); box-shadow: var(--shadow-card); border-color: var(--primary-start); }
    .trending-card:hover::before{ opacity: .08; }
    .trending-poster{ width:100%; aspect-ratio: 2/3; object-fit: cover; display:block; }
    .trending-info{ padding: .6rem .7rem; }
    .trending-title{ font-weight: 600; font-size: .95rem; line-height: 1.3; display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical; overflow:hidden; margin:0 0 .25rem; }
    .trending-rating{ color: var(--accent-green); font-size: .85rem; font-weight: 600; }

    /* Mood suggestions */
    .mood-suggestions{ margin-bottom: var(--space-5); animation: fadeInUp .8s ease-out .5s both; }
    .suggestions-title{ display:flex; align-items:center; justify-content:center; gap:.6rem; color: var(--text-secondary); margin-bottom: 1rem; font-weight:600; font-size: clamp(.9rem, 2.8vw, 1rem); }
    .suggestions-grid{ display:flex; flex-wrap:wrap; gap: .6rem .6rem; justify-content:center; max-width: 980px; margin: 0 auto; padding-inline: .2rem; }
    .suggestion-button{
      position: relative; overflow:hidden; cursor:pointer;
      padding: .65rem .95rem; border-radius: 2rem; font-size: clamp(.85rem, 2.7vw, .95rem);
      background: var(--bg-card); color: var(--text-secondary);
      border: 1px solid var(--border-color); transition: all .25s ease;
      touch-action: manipulation;
    }
    .suggestion-button:hover{ color:#fff; border-color: var(--primary-start); transform: translateY(-2px); }
    .suggestion-button::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; border-radius: inherit; }
    .suggestion-button:hover::before{ opacity: 1; }
    .suggestion-button span{ position: relative; z-index: 1; }

    /* History */
    .history-section{ margin-bottom: var(--space-5); display:none; }
    .history-section.show{ display:block; animation: fadeInUp .6s ease-out both; }
    .history-grid{ display:grid; gap: .6rem; max-width: min(820px, 95vw); margin: 0 auto; }
    .history-item{
      display:flex; align-items:center; justify-content:space-between; gap: .8rem;
      padding: .8rem .9rem; border:1px solid var(--border-color); border-radius: .75rem; background: var(--bg-card);
      cursor:pointer; transition: all .25s ease;
    }
    .history-item:hover{ border-color: var(--accent-cyan); background: var(--bg-secondary); }
    .history-mood{ font-weight: 600; color: var(--text-primary); font-size: clamp(.95rem, 2.8vw, 1rem); }
    .history-date{ color: var(--text-muted); font-size: .85rem; }

    /* Movies grid */
    .movies-section{ display:none; }
    .movies-section.show{ display:block; }
    .movies-grid{
      display:grid;
      grid-template-columns: repeat(auto-fill, minmax(clamp(150px, 42vw, 220px), 1fr));
      gap: clamp(.8rem, 2.5vw, 1.5rem);
      padding: var(--space-4) 0;
    }
    .movie-card{
      background: var(--bg-card); border:1px solid var(--border-color); border-radius: 1rem;
      overflow:hidden; cursor: pointer; position: relative; transition: transform .25s ease, border-color .25s ease, box-shadow .25s ease;
      animation: fadeInUp .6s ease-out both;
    }
    .movie-card:hover{ transform: translateY(-6px) scale(1.02); border-color: var(--primary-start); box-shadow: var(--shadow-card); }
    .movie-card::before{ content:''; position:absolute; inset:0; background: var(--gradient-primary); opacity:0; transition: opacity .25s ease; z-index:1; pointer-events:none; }
    .movie-card:hover::before{ opacity: .08; }
    .movie-poster{ width:100%; aspect-ratio: 2/3; object-fit: cover; display:block; position: relative; z-index:2; }
    .movie-info{ padding: .85rem .9rem; position: relative; z-index: 2; }
    .movie-title{ font-weight: 700; margin: 0 0 .35rem; line-height: 1.35; font-size: clamp(.95rem, 2.8vw, 1.05rem); }
    .movie-year{ color: var(--text-secondary); font-size: .9rem; margin: 0 0 .6rem; }
    .movie-platforms{ display:flex; gap:.4rem; flex-wrap:wrap; }
    .platform-badge{ padding: .25rem .5rem; background: var(--gradient-primary); color:#fff; font-size: .7rem; border-radius:.5rem; font-weight:700; }

    /* Loading screen */
    .loading-screen{
      position: fixed; inset: 0; display:none; align-items:center; justify-content:center;
      background: color-mix(in oklab, black 70%, transparent);
      backdrop-filter: blur(20px); z-index: 100;
      padding: var(--space-4);
    }
    .loading-content{ text-align:center; animation: fadeInScale .4s ease-out both; max-width: 90vw; }
    .loading-spinner{
      width: clamp(64px, 20vw, 88px); height: clamp(64px, 20vw, 88px);
      margin: 0 auto 1rem; border: 4px solid var(--border-color); border-top: 4px solid var(--primary-start);
      border-radius: 50%; animation: spin 1s linear infinite; position: relative;
    }
    .loading-spinner::after{
      content:''; position:absolute; inset: .5rem; border: 2px solid transparent; border-top: 2px solid var(--accent-cyan); border-radius:50%;
      animation: spin .8s linear infinite reverse;
    }
    .loading-text{ font-size: clamp(1.1rem, 3.8vw, 1.5rem); font-weight:800; margin: .25rem 0 .4rem;
      background: var(--gradient-primary); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .loading-subtitle{ color: var(--text-secondary); max-width: 520px; margin: 0 auto; font-size: clamp(.9rem, 2.7vw, 1rem); }
    .loading-dots{ display:flex; gap:.5rem; justify-content:center; margin-top: 1.2rem; }
    .loading-dot{ width:.75rem; height:.75rem; border-radius:50%; background: var(--primary-start); animation: loadingDots 1.4s ease-in-out infinite; }
    .loading-dot:nth-child(2){ animation-delay:.2s; background: var(--primary-end); }
    .loading-dot:nth-child(3){ animation-delay:.4s; background: var(--accent-cyan); }

    /* Modal */
    .modal{ position: fixed; inset:0; display:none; align-items:center; justify-content:center; z-index: 200; padding: var(--space-4); background: rgba(0,0,0,.88); }
    .modal-content{
      background: var(--bg-card); border:1px solid var(--border-glow);
      border-radius: 1rem; width: min(900px, 96vw); max-height: min(90vh, 100svh - 2rem);
      overflow: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none;
      animation: fadeInScale .28s ease-out both; position: relative;
    }
    .modal-content::-webkit-scrollbar{ display:none; }
    .modal-close{
      position: sticky; top: .75rem; float: right; margin: .75rem;
      width: 2.5rem; height: 2.5rem; border-radius: 50%;
      border: none; background: var(--bg-glass); color: var(--text-primary);
      font-size: 1.2rem; cursor: pointer; z-index: 10; transition: background .2s ease, color .2s ease;
    }
    .modal-close:hover{ background: var(--primary-start); color: #fff; }

    /* Auth Modal */
    .auth-modal{
      position: fixed; inset: 0; z-index: 300;
      display: none; align-items: center; justify-content: center;
      background: rgba(0,0,0,.88); padding: var(--space-4);
    }
    .auth-modal[aria-hidden="false"]{ display: flex; }
    .auth-panel{
      background: var(--bg-card); border: 1px solid var(--border-glow);
      border-radius: 1rem; padding: 1.5rem; width: min(400px, 94vw);
      animation: fadeInScale .25s ease-out both;
    }
    .auth-panel h3{
      margin: 0 0 1rem; font-family: 'Space Grotesk', sans-serif;
      font-size: 1.4rem; background: var(--gradient-primary);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .auth-field{ margin-bottom: .75rem; }
    .auth-input{
      width: 100%; padding: .75rem .9rem; border-radius: .6rem;
      border: 1px solid var(--border-color); background: var(--bg-secondary);
      color: var(--text-primary); font-size: 1rem;
      transition: border-color .2s ease, box-shadow .2s ease;
    }
    .auth-input:focus{ outline: none; border-color: var(--primary-start); box-shadow: var(--shadow-neon); }
    .auth-input::placeholder{ color: var(--text-muted); }
    .auth-toggle{
      background: none; border: none; color: var(--accent-cyan);
      cursor: pointer; font-size: .88rem; padding: 0;
    }
    .auth-toggle:hover{ text-decoration: underline; }
    .auth-error{
      margin-top: .75rem; font-size: .9rem; color: #FF8A8A;
      min-height: 1.2em;
    }
    .auth-success{
      margin-top: .75rem; font-size: .9rem; color: var(--accent-green);
      min-height: 1.2em;
    }

    /* Buttons */
    .primary-button{
      padding: .75rem 1.05rem; border-radius: .75rem; font-weight: 800; cursor: pointer;
      transition: all .25s ease; border: none;
      background: var(--gradient-primary); color: #fff;
    }
    .primary-button:hover{ transform: scale(1.03); box-shadow: var(--shadow-intense); }
    .primary-button:disabled{ opacity: .6; cursor: not-allowed; transform: none; }
    .secondary-button{
      padding: .75rem 1.05rem; border-radius: .75rem; font-weight: 800; cursor: pointer;
      transition: all .25s ease; border: 1px solid var(--border-color);
      background: transparent; color: var(--text-secondary);
    }
    .secondary-button:hover{ border-color: var(--accent-cyan); color: var(--accent-cyan); box-shadow: 0 0 18px rgba(50,200,255,.25); }

    /* Footer */
    .site-footer{ width:100%; background: linear-gradient(180deg, rgba(20,20,30,0) 0%, rgba(12,12,18,1) 30%); border-top: 1px solid var(--border-color); margin-top: var(--space-5); }
    .site-footer__inner{ max-width: 1200px; margin: 0 auto; padding: 1rem var(--space-4); display:flex; align-items:center; justify-content:space-between; gap: .75rem; }
    .site-footer__brand{ color: var(--text-primary); font-weight: 800; letter-spacing: .3px; font-size: clamp(.95rem, 3vw, 1rem); }
    .site-footer__links{ display:flex; align-items:center; gap: .5rem; }
    .site-footer__links a{ color: var(--text-secondary); text-decoration: none; font-size: .9rem; transition: color .2s ease; }
    .site-footer__links a:hover{ color: var(--accent-cyan); }
    .site-footer__links .dot{ color: var(--text-muted); }

    /* Animations */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInScale { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes loadingDots { 0%, 80%, 100% { transform: scale(0); opacity: 0.5; } 40% { transform: scale(1); opacity: 1; } }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="logo" id="logoHome">
      <div class="logo-icon">CV</div>
      <span class="logo-text">CineVibe</span>
    </div>
    <div class="nav-actions">
      <button class="history-button" id="historyToggle">üìö History</button>
      <button class="history-button" id="authStateBtn">üîê Sign In</button>
    </div>
  </nav>

  <div class="container">
    <!-- Hero -->
    <section class="hero-section" id="heroSection">
      <h1 class="hero-title">Find Your Perfect Vibe</h1>
      <p class="hero-subtitle">Describe your mood, and our AI will curate the perfect movies for you. From nostalgic comfort to mind-bending thrillers ‚Äî we've got your vibe.</p>

      <form class="search-form" id="searchForm">
        <input type="text" id="moodInput" class="search-input" placeholder="Describe your mood... e.g., 'nostalgic 90s comfort movies'" autocomplete="off">
        <button type="submit" class="search-button" id="searchButton">‚ú® Find Movies</button>
      </form>
    </section>

    <!-- Trending -->
    <section class="trending-section" id="trendingSection">
      <h2 class="section-title">üî• Trending Now</h2>
      <div class="trending-grid" id="trendingGrid"></div>
    </section>

    <!-- History -->
    <section class="history-section" id="historySection">
      <h2 class="section-title">üìö Your Search History</h2>
      <div class="history-grid" id="historyGrid"></div>
    </section>

    <!-- Mood Suggestions -->
    <div class="mood-suggestions" id="moodSuggestions">
      <div class="suggestions-title"><span>üí´</span><span>Popular vibes to explore:</span></div>
      <div class="suggestions-grid">
        <button class="suggestion-button" data-mood="something that'll mess with my head and leave me questioning reality"><span>Mind-bending psychological thriller</span></button>
        <button class="suggestion-button" data-mood="aesthetic dark academia vibes with mystery"><span>Dark academia mystery</span></button>
        <button class="suggestion-button" data-mood="chaotic energy with unhinged characters"><span>Chaotic energy films</span></button>
        <button class="suggestion-button" data-mood="nostalgic 90s/2000s comfort movies"><span>Y2K nostalgia comfort</span></button>
        <button class="suggestion-button" data-mood="visually stunning sci-fi that blows my mind"><span>Visually stunning sci-fi</span></button>
        <button class="suggestion-button" data-mood="lesbian/sapphic romance that makes me cry happy tears"><span>Sapphic romance tearjerker</span></button>
        <button class="suggestion-button" data-mood="foreign films that are pure cinema"><span>Foreign cinema masterpieces</span></button>
        <button class="suggestion-button" data-mood="underground cult classics nobody talks about"><span>Underground cult classics</span></button>
        <button class="suggestion-button" data-mood="horror that's actually scary not just jumpscares"><span>Actually scary horror</span></button>
        <button class="suggestion-button" data-mood="feel-good movies that restore faith in humanity"><span>Faith in humanity restored</span></button>
      </div>
    </div>

    <!-- Movies Section -->
    <div class="movies-section" id="moviesSection">
      <h2 class="section-title" id="moviesTitle">Your Curated Selection</h2>
      <div class="movies-grid" id="moviesGrid"></div>
    </div>
  </div>

  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <h2 class="loading-text">Curating your perfect vibe<span id="loadingDots">...</span></h2>
      <p class="loading-subtitle">Our AI is analyzing your mood and finding movies that match your exact energy</p>
      <div class="loading-dots"><div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div></div>
    </div>
  </div>

  <!-- Movie Modal -->
  <div class="modal" id="movieModal">
    <div class="modal-content" id="modalContent">
      <button class="modal-close" id="modalClose" aria-label="Close">&times;</button>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="auth-modal" id="authModal" aria-hidden="true">
    <div class="auth-panel" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <form id="authForm" onsubmit="return false;">
        <h3 id="authTitle">Sign in to CineVibe</h3>
        <div class="auth-field">
          <input id="authEmail" class="auth-input" type="email" placeholder="Email" autocomplete="email" required />
        </div>
        <div class="auth-field">
          <input id="authPassword" class="auth-input" type="password" placeholder="Password (min 6 characters)" autocomplete="current-password" required minlength="6" />
        </div>
        <div style="display:flex;gap:.5rem;align-items:center;">
          <button id="authSubmit" class="primary-button" type="submit" style="flex:1">Sign In</button>
          <button id="authClose" class="secondary-button" type="button">Close</button>
        </div>
        <div class="auth-aux" style="display:flex;justify-content:space-between;align-items:center;margin-top:.6rem;">
          <div style="font-size:.88rem;color:var(--text-secondary)"><button id="authModeToggle" class="auth-toggle" type="button">Create account</button></div>
        </div>
        <div class="auth-error" id="authError"></div>
        <div class="auth-success" id="authSuccess"></div>
      </form>
    </div>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="site-footer__inner">
      <div class="site-footer__brand">¬© 2025 Jayesh_Mal</div>
      <nav class="site-footer__links">
        <a href="https://www.instagram.com/jayesh_cringzz/" target="_blank" rel="noopener">Instagram</a>
        <span class="dot">‚Ä¢</span>
        <a href="https://github.com/jayesh25-trade" target="_blank" rel="noopener">GitHub</a>
      </nav>
    </div>
  </footer>

  <!-- Supabase SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- FIXED Supabase Auth Script -->
  <script>
    // ============ SUPABASE CONFIGURATION ============
    // Replace these with your Supabase project credentials
    const SUPABASE_URL = 'https://ipaduwfqyapuqhvvicqm.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwYWR1d2ZxeWFwdXFodnZpY3FtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjEzNzk4NTEsImV4cCI6MjA3Njk1NTg1MX0.Gr8n1k-q3IT8IYvIrM4lH8CVGQOsRKkvSXM01TF5ibk';

    // Initialize Supabase client
    window.supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ============ AUTH STATE MANAGEMENT (FIXED) ============
    let currentUser = null;
    let currentSession = null;
    let pendingMoodForAuth = null;

    const authModal = document.getElementById('authModal');
    const authForm = document.getElementById('authForm');
    const authEmail = document.getElementById('authEmail');
    const authPassword = document.getElementById('authPassword');
    const authSubmit = document.getElementById('authSubmit');
    const authClose = document.getElementById('authClose');
    const authModeToggle = document.getElementById('authModeToggle');
    const authErrorEl = document.getElementById('authError');
    const authSuccessEl = document.getElementById('authSuccess');
    const authStateBtn = document.getElementById('authStateBtn');
    const authTitle = document.getElementById('authTitle');

    let isLoginMode = true;

    // Update UI based on auth state
    function updateAuthStateUI(user) {
      currentUser = user;
      if (authStateBtn) {
        authStateBtn.textContent = user ? 'üîì Sign Out' : 'üîê Sign In';
      }
    }

    // Show auth modal
    function showAuthModal(pendingMood = null) {
      pendingMoodForAuth = pendingMood;
      isLoginMode = true;
      authTitle.textContent = 'Sign in to CineVibe';
      authModeToggle.textContent = 'Create account';
      authSubmit.textContent = 'Sign In';
      authErrorEl.textContent = '';
      authSuccessEl.textContent = '';
      authEmail.value = '';
      authPassword.value = '';
      authModal.style.display = 'flex';
      authModal.setAttribute('aria-hidden', 'false');
      setTimeout(() => authEmail.focus(), 100);
    }

    // Close auth modal
    function closeAuthModal() {
      authModal.style.display = 'none';
      authModal.setAttribute('aria-hidden', 'true');
      pendingMoodForAuth = null;
    }

    // Toggle between login and signup modes
    authModeToggle.addEventListener('click', () => {
      isLoginMode = !isLoginMode;
      authTitle.textContent = isLoginMode ? 'Sign in to CineVibe' : 'Create your account';
      authModeToggle.textContent = isLoginMode ? 'Create account' : 'Have an account? Sign in';
      authSubmit.textContent = isLoginMode ? 'Sign In' : 'Sign Up';
      authErrorEl.textContent = '';
      authSuccessEl.textContent = '';
    });

    // Close modal button
    authClose.addEventListener('click', closeAuthModal);

    // Close modal on backdrop click
    authModal.addEventListener('click', (e) => {
      if (e.target === authModal) closeAuthModal();
    });

    // ============ AUTH FORM SUBMISSION (FIXED) ============
    authForm.addEventListener('submit', async (ev) => {
      ev.preventDefault();
      authSubmit.disabled = true;
      authErrorEl.textContent = '';
      authSuccessEl.textContent = '';

      const email = authEmail.value.trim();
      const password = authPassword.value.trim();

      // Basic validation
      if (!email || !password) {
        authErrorEl.textContent = 'Please enter both email and password.';
        authSubmit.disabled = false;
        return;
      }

      if (password.length < 6) {
        authErrorEl.textContent = 'Password must be at least 6 characters.';
        authSubmit.disabled = false;
        return;
      }

      try {
        if (isLoginMode) {
          // ===== SIGN IN =====
          const { data, error } = await window.supabase.auth.signInWithPassword({
            email,
            password
          });

          if (error) {
            // Handle specific error messages
            if (error.message.includes('Invalid login credentials')) {
              authErrorEl.textContent = 'Invalid email or password. Please try again.';
            } else if (error.message.includes('Email not confirmed')) {
              authErrorEl.textContent = 'Please confirm your email before signing in.';
            } else {
              authErrorEl.textContent = error.message;
            }
          } else {
            // Success - close modal and update UI
            currentSession = data.session;
            currentUser = data.user;
            updateAuthStateUI(currentUser);
            closeAuthModal();

            // If there was a pending mood search, execute it now
            if (pendingMoodForAuth) {
              const mood = pendingMoodForAuth;
              pendingMoodForAuth = null;
              document.getElementById('moodInput').value = mood;
              setTimeout(() => {
                document.getElementById('searchForm').dispatchEvent(new Event('submit', { cancelable: true }));
              }, 150);
            }
          }
        } else {
          // ===== SIGN UP =====
          const redirectUrl = window.location.origin + '/';

          const { data, error } = await window.supabase.auth.signUp({
            email,
            password,
            options: {
              emailRedirectTo: redirectUrl
            }
          });

          if (error) {
            // Handle specific error messages
            if (error.message.includes('already registered') || error.message.includes('already been registered')) {
              authErrorEl.textContent = 'This email is already registered. Please sign in instead.';
            } else if (error.message.includes('valid email')) {
              authErrorEl.textContent = 'Please enter a valid email address.';
            } else {
              authErrorEl.textContent = error.message;
            }
          } else {
            // Check if email confirmation is required
            if (data.user && !data.session) {
              // Email confirmation required
              authSuccessEl.textContent = 'Account created! Please check your email to confirm.';
            } else if (data.session) {
              // Auto-confirmed (email confirmation disabled in Supabase settings)
              currentSession = data.session;
              currentUser = data.user;
              updateAuthStateUI(currentUser);
              closeAuthModal();

              if (pendingMoodForAuth) {
                const mood = pendingMoodForAuth;
                pendingMoodForAuth = null;
                document.getElementById('moodInput').value = mood;
                setTimeout(() => {
                  document.getElementById('searchForm').dispatchEvent(new Event('submit', { cancelable: true }));
                }, 150);
              }
            } else {
              authSuccessEl.textContent = 'Account created successfully! You can now sign in.';
              // Switch to login mode
              setTimeout(() => {
                isLoginMode = true;
                authTitle.textContent = 'Sign in to CineVibe';
                authModeToggle.textContent = 'Create account';
                authSubmit.textContent = 'Sign In';
              }, 1500);
            }
          }
        }
      } catch (err) {
        console.error('Auth error:', err);
        authErrorEl.textContent = 'An unexpected error occurred. Please try again.';
      } finally {
        authSubmit.disabled = false;
      }
    });

    // ============ SIGN OUT =====
    authStateBtn.addEventListener('click', async () => {
      if (currentUser) {
        await window.supabase.auth.signOut();
        currentUser = null;
        currentSession = null;
        updateAuthStateUI(null);
        // Hide movies section on sign out
        document.getElementById('moviesSection')?.classList.remove('show');
      } else {
        showAuthModal();
      }
    });

    // ============ AUTH STATE LISTENER (CRITICAL FIX) ============
    // Set up auth state listener FIRST - this is the key fix!
    window.supabase.auth.onAuthStateChange((event, session) => {
      // Only synchronous state updates here - no async calls!
      currentSession = session;
      currentUser = session?.user ?? null;
      updateAuthStateUI(currentUser);

      console.log('Auth state changed:', event, currentUser?.email);
    });

    // THEN check for existing session
    window.supabase.auth.getSession().then(({ data: { session } }) => {
      currentSession = session;
      currentUser = session?.user ?? null;
      updateAuthStateUI(currentUser);
      console.log('Initial session check:', currentUser?.email || 'No user');
    });

    // ============ KEYBOARD SHORTCUTS ============
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && authModal.style.display === 'flex') {
        closeAuthModal();
      }
    });
  </script>

  <!-- Main App Logic -->
  <script src="./prompt.js"></script>
</body>
</html>
